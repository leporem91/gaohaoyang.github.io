---
layout: post
title:  "C# 간단한 기능구현"
date:   2015-01-02 17:04:00
categories: Programming(C#)
tags: C#
---

* content
{:toc}


## Exception 팁

### 인터넷 연결 체크
```
//using webclient
public static bool CheckForInternetConnection()
{
    try
    {
        using (var client = new WebClient())
        using (var stream = client.OpenRead("http://www.google.com"))
        {
            return true;
        }
    }
    catch
    {
        return false;
    }
}
  
// using ping
Ping myPing = new Ping();
String host = "google.com";
byte[] buffer = new byte[32];
int timeout = 1000;
PingOptions pingOptions = new PingOptions();
PingReply reply = myPing.Send(host, timeout, buffer, pingOptions);
if (reply.Status == IPStatus.Success) {
  // presumably online
}
```

## 이미지와 문자열 변환

BitmapImage to String
```
if ((checkStream = openFileDialog.OpenFile()) != null)
                    {
                        BitmapImage src = new BitmapImage(new Uri(openFileDialog.FileName));
                        Profile_image.Source = src; //Image
 
                        image = ImageToStringConvert(src);
                    }
 
 public static string ImageToStringConvert(BitmapImage Bitmapimage)
        {
            //BitmapImage To Byte[] Data
            MemoryStream memStream = new MemoryStream();
            JpegBitmapEncoder encoder = new JpegBitmapEncoder();
            encoder.Frames.Add(BitmapFrame.Create(Bitmapimage));
            encoder.Save(memStream);
 
            byte[] Image_BinaryData = memStream.GetBuffer();
 
            // BinaryData To StringData
            string ImageString = Convert.ToBase64String(Image_BinaryData);
 
            return ImageString;
        }
```

이미지 파일 자체를 선택하면 BitmapImage 객체로 받을 수 있습니다.

Image객체의 Source Property는 ImageSource 객체인데 BitmapImage 에서 자동 형변환 됩니다.

만약 실제 ImageToString을 구현하고 싶으면 Source값을 넣어준 image객체를 매개변수로 넣는 것으로 바꾸면 됩니다.

String to Image
```
public static Image ConvertStringToImage(string str)
     {
         if (str == null || str=="")
             return null;
 
         Image img = new Image();
 
         byte[] jpgimages = Convert.FromBase64String(str);
         MemoryStream streams = new MemoryStream(jpgimages);
         JpegBitmapDecoder decoders = new JpegBitmapDecoder(streams, BitmapCreateOptions.None, BitmapCacheOption.None);
         BitmapSource imagesources = decoders.Frames[0];
         img.Source = imagesources;
 
         return img;
     }
```

## Drag and Drop

```
private void Form1_DragDrop(object sender, DragEventArgs e)
{
	if (e.Data.GetDataPresent(DataFormats.FileDrop))
	{
		string[] files = (string[])e.Data.GetData(DataFormats.FileDrop);
		foreach (string filePath in files)
		{
			MessageBox.Show(filePath);
		}
	}
}
private void Form1_DragEnter(object sender, DragEventArgs e)
{
	e.Effect = DragDropEffects.All;
}
```


